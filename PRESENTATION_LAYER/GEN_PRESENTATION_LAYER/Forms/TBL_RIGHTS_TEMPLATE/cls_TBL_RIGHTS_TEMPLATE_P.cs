using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using DevExpress.XtraEditors;
using System.Data;
using BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE;
using DevExpress.XtraBars;
using System.Reflection;
using System.Windows.Forms;
using DevExpress.XtraEditors.Controls;

namespace PRESENTATION_LAYER.GEN_PRESENTATION_LAYER.Forms.TBL_RIGHTS_TEMPLATE
{
      public class cls_TBL_RIGHTS_TEMPLATE_P
      {

            Boolean isAllowedInsertion = true, isAllowedUpdation = true, isAllowedDeletion = true, isDisturebedOnce = false, isAutoGeneratedOption = false;

            GEN.GEN_GEN.GenericClasses.Form.Gen_Form ObjGenForm;

            GEN.GEN_GEN.GenericClasses.cls_MessageBox obj_cls_MessageBox = new GEN.GEN_GEN.GenericClasses.cls_MessageBox();

            DATASET.GEN_DATASET.cls_DataSet obj_cls_DataSet_GEN = new DATASET.GEN_DATASET.cls_DataSet();

            GEN.GEN_GEN.Look.frlLOOKUP obj_frlLOOKUP = null;

            BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_TBL_RIGHTS_TEMPLATE obj_cls_TBL_RIGHTS_TEMPLATE = new BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_TBL_RIGHTS_TEMPLATE();

            frm_TBL_RIGHTS_TEMPLATE obj_frm_TBL_RIGHTS_TEMPLATE = null;

            DataTable dt_Datanavigator = new DataTable();

            DataTable dt_FinalTableToBeInserted = new DataTable();

            DataTable dt_VisibleBase = new DataTable();
            DataTable dt_ValueBase = new DataTable();

            void InitializeComponents(frm_TBL_RIGHTS_TEMPLATE pobj_frm_TBL_RIGHTS_TEMPLATE, String pID)
            {

                  obj_frm_TBL_RIGHTS_TEMPLATE = pobj_frm_TBL_RIGHTS_TEMPLATE;
                  GEN.GEN_GEN.GenericClasses.cls_CustomeForm.applyPropertiesOnXtraForm(obj_frm_TBL_RIGHTS_TEMPLATE, 'A');
                  obj_cls_TBL_RIGHTS_TEMPLATE.obj_XtraForm = pobj_frm_TBL_RIGHTS_TEMPLATE;

                  if (!obj_cls_TBL_RIGHTS_TEMPLATE.Open())
                        obj_frm_TBL_RIGHTS_TEMPLATE.Close();



                  if (pID == "N")
                        Referesh("True");
                  else
                  {
                        obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.Text = pID;

                        selection("V", obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.Text.Trim());

                  }

            }


            public cls_TBL_RIGHTS_TEMPLATE_P(frm_TBL_RIGHTS_TEMPLATE pobj_frm_TBL_RIGHTS_TEMPLATE, String pID, GEN.GEN_GEN.GenericClasses.Form.Gen_Form pObjGenForm, bool pIs_DisturbanceOnce)//VVVParamVVV
            {
                  ObjGenForm = pObjGenForm;
                  isDisturebedOnce = pIs_DisturbanceOnce;
                  InitializeComponents(pobj_frm_TBL_RIGHTS_TEMPLATE, pID);

            }


            public bool validate(out string value, bool pIs_Delete)
            {
                  if (pIs_Delete)
                  {

                        if (!isAllowedDeletion)
                        {
                              value = obj_cls_MessageBox.error_delete_rights;
                              return false;

                        }

                        if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'I')
                        {
                              value = obj_cls_MessageBox.error_selection_msg;
                              return false;
                        }

                  }
                  else
                  {
                        if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'I')
                        {
                              if (!isAllowedInsertion)
                              {
                                    value = obj_cls_MessageBox.error_insert_rights;
                                    return false;

                              }

                        }
                        if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'U')
                        {
                              if (!isAllowedUpdation)
                              {
                                    value = obj_cls_MessageBox.error_update_rights;
                                    return false;

                              }

                        }

                        if (obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_primaryKey.EditValue.ToString() == "")
                        {

                              GEN.GEN_GEN.GenericClasses.Appearance.cls_Appearance.applyFocusAppreanceTextEdit(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_primaryKey);
                              value = "V_P";
                              return false;

                        }



                        if (obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_name.EditValue.ToString() == "")
                        {

                              GEN.GEN_GEN.GenericClasses.Appearance.cls_Appearance.applyFocusAppreanceTextEdit(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_name);
                              value = obj_cls_MessageBox.error_Name_msg;
                              return false;

                        }




                  }

                  if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'U')
                        if (Convert.ToString(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.EditValue) == "")
                        {
                              value = obj_cls_MessageBox.error_ID_msg;
                              return false;
                        }
                  if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'I')
                        if (!obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Checked && Convert.ToString(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.EditValue) == "")
                        {
                              value = obj_cls_MessageBox.error_ID_msg;
                              return false;
                        }


                  value = "N";
                  return true;
            }




            public void getMax()
            {
                  if (obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Checked)
                  {

                        int tempID = obj_cls_DataSet_GEN.f_GETMAX("TBL_RIGHTS_TEMPLATE", 0, 0, 0, "", "", "");
                        obj_frm_TBL_RIGHTS_TEMPLATE.maxID = tempID.ToString();
                        obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.Text = obj_frm_TBL_RIGHTS_TEMPLATE.maxID;

                  }
            }



            public void loadGridLookUpEdit(string Status)
            {


                  GEN_PRESENTATION_LAYER.cls_bindGridLookUpEdit.TBL_RIGHTS_TEMPLATE(obj_frm_TBL_RIGHTS_TEMPLATE.GridLookUpEdit_RIGHTS_TEMPLATE_parentKey);
                  // GEN_PRESENTATION_LAYER.cls_bindGridLookUpEdit.TBL_RIGHTS_TEMPLATE(obj_frm_TBL_RIGHTS_TEMPLATE.GridLookUpEdit_RIGHTS_TEMPLATE_parentKey);

            }

            public string valueGetting(bool pIs_Delete)
            {

                  try
                  {

                        string validate_value = "";

                        if (!validate(out validate_value, pIs_Delete))
                        {

                              if (validate_value == "N")
                                    return "V_P";
                              else
                                    return validate_value;

                        }

                        if (pIs_Delete)
                        {
                              obj_cls_TBL_RIGHTS_TEMPLATE.STATUS = "D";
                              obj_cls_TBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_ID = Convert.ToString(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.EditValue);
                        }
                        {

                              obj_cls_TBL_RIGHTS_TEMPLATE.Is_Auto_Generated = obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Checked;

                              if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'I')
                              {

                                    if (!obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Checked)
                                          obj_cls_TBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_ID = Convert.ToString(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.EditValue);
                              }
                              else
                                    obj_cls_TBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_ID = Convert.ToString(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.EditValue);



                              string defaultValue = "";
                              if (obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_visibleTypeOrValueType.SelectedItem.ToString() == "Value")
                              {
                                    if ((obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.SelectedItem.ToString() == "Float" || obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.SelectedItem.ToString() == "Int"))
                                    {

                                          if (obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_defaultValue.EditValue.ToString().Trim() == "")
                                                defaultValue = "0";
                                          else
                                                defaultValue = obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_defaultValue.EditValue.ToString().Trim();
                                    }
                                    else if (obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.SelectedItem.ToString() == "String")
                                          defaultValue = obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_defaultValue.EditValue.ToString().Trim();
                                    else if (obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.SelectedItem.ToString() == "DateTime")
                                          defaultValue = obj_frm_TBL_RIGHTS_TEMPLATE.DateEdit_date.DateTime.ToString(GEN.GEN_GEN.GenericClasses.cls_GENGlobalClass.formatForDefaultDateTimeValuesInRights);
                                    else if (obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.SelectedItem.ToString() == "Bool")
                                          defaultValue = obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_edit.Checked ? "True" : "False";
                              }
                              else
                              {
                                    defaultValue = "False";

                              }
                              //return defaultValue;

                              obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Clear();
                              obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Rows.Add(

                                    obj_frm_TBL_RIGHTS_TEMPLATE.checkEdit1.Checked ? "N" : (obj_frm_TBL_RIGHTS_TEMPLATE.GridLookUpEdit_RIGHTS_TEMPLATE_parentKey.EditValue == null ? "N" : obj_frm_TBL_RIGHTS_TEMPLATE.GridLookUpEdit_RIGHTS_TEMPLATE_parentKey.EditValue.ToString())
                              , obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_primaryKey.EditValue.ToString().Trim()
                              , obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_name.EditValue.ToString().Trim()
                              , 0// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                              , obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_nature.EditValue.ToString().Trim()
                              , defaultValue
                              , obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.EditValue.ToString().Trim()
                              , ""
                              , false// obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_RIGHTS_TEMPLATE_isAddedDirectly.Checked
                               , obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_visibleTypeOrValueType.EditValue.ToString().Trim()
                              );

                        }



                  }
                  catch (Exception ex)
                  {

                        return ex.Message;

                  }

                  return "ok";

            }
            public string valueSetting(DataSet ds)
            {

                  try
                  {

                        DataTable dt_Main = ds.Tables[0];

                        obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Checked = (Boolean)dt_Main.Rows[0][GEN.GEN_GEN.GenericClasses.cls_GENGlobalClass.Is_Auto_Generated];



                        obj_frm_TBL_RIGHTS_TEMPLATE.GridLookUpEdit_RIGHTS_TEMPLATE_parentKey.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_parentKey];
                        obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_primaryKey.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_primaryKey];
                        obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_name.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_name];
                        obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_nature.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_nature];
                        obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_defaultValue.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_defaultValue];
                        obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_valueType.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_valueType];
                        //obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_valueFormat.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_valueFormat];
                        obj_frm_TBL_RIGHTS_TEMPLATE.ComboBoxEdit_RIGHTS_TEMPLATE_visibleTypeOrValueType.EditValue = dt_Main.Rows[0][BLL.GEN_BLL.TBL_RIGHTS_TEMPLATE.cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_visibleTypeOrValueType];

                        obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus = 'U';
                        obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Enabled = false;
                  }
                  catch (Exception ex)
                  {

                        return ex.Message;

                  }

                  return "ok";

            }


            public void Referesh(String isComplete)
            {

                  if (isComplete == "True")
                  {

                        //try
                        //{
                        //    //DataRow[] drr = MDIClassic.dtRightsButton.Select(" [Parent Key] = '" + obj_frm_TBL_PRODUCTS_2.Tag + "'");
                        //    foreach (DataRow d in drr)
                        //    {
                        //        if (GEN.GEN_GEN.GenericClasses.UserRIghts.cls_RightsKeys.key_del == d["Primary Key"].ToString())
                        //        {
                        //            isAllowedDeletion = true;
                        //        }
                        //        else if (GEN.GEN_GEN.GenericClasses.UserRIghts.cls_RightsKeys.key_insert == d["Primary Key"].ToString())
                        //        {
                        //            isAllowedInsertion = true;
                        //        }
                        //        else if (GEN.GEN_GEN.GenericClasses.UserRIghts.cls_RightsKeys.key_update == d["Primary Key"].ToString())
                        //        {
                        //            isAllowedUpdation = true;
                        //        }
                        //    }

                        //}
                        //catch (Exception ex)
                        //{
                        //    //throw;
                        //}



                        loadGridLookUpEdit("TBL_RIGHTS_TEMPLATE");

                        obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Visible = isAutoGeneratedOption;

                        if (!isAllowedInsertion && !isAllowedUpdation)
                              obj_frm_TBL_RIGHTS_TEMPLATE.SimpleButton_Save.Enabled = false;
                        if (!isAllowedDeletion)
                              obj_frm_TBL_RIGHTS_TEMPLATE.SimpleButton_Delete.Enabled = false;

                        selection("N", "");
                        Referesh("False");

                  }
                  else if (isComplete == "Partial")
                  {
                        selection("N", "");
                        loadGridLookUpEdit("TBL_RIGHTS_TEMPLATE");

                        Referesh("False");

                  }


                  ObjGenForm.GenRefresh();
                  obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus = 'I';
                  obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_Is_AutoGenegereted.Enabled = true;
                  //obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_navigate.Checked = false;
                  getMax();

            }

            public void Delete()
            {

                  string executeFunctions = valueGetting(true);

                  if (executeFunctions != "ok")
                  {
                        if (executeFunctions != "N")
                        {
                              if (executeFunctions == "V_P")
                              {
                                    obj_cls_MessageBox.MessageBoxStatic("VP_E");
                                    return;
                              }
                              else
                              {
                                    obj_cls_MessageBox.MessageBoxDynamics(executeFunctions, "I_E");
                                    return;

                              }
                        }
                  }


                  if (obj_cls_MessageBox.MessageBoxStatic("D_Q") == "no")
                  {

                        return;

                  }





                  obj_cls_TBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_ID = obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.Text;

                  if (obj_cls_TBL_RIGHTS_TEMPLATE.deletion())
                  {
                        Referesh("Partial");
                        if (isDisturebedOnce)
                              obj_frm_TBL_RIGHTS_TEMPLATE.Close();
                  }

            }

            public void loadTemplateToRightsTableAndAddAdmin()
            {

                  obj_cls_TBL_RIGHTS_TEMPLATE.loadTemplateToRightsTables('I');
            }

            public void Save(bool pIsDirectFromMDI)
            {
                  obj_cls_TBL_RIGHTS_TEMPLATE.Is_BulkInsertion = pIsDirectFromMDI;
                  if (pIsDirectFromMDI)
                  {
                        loadRightsFromMDI_recursiveParent();
                        if (obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Count ==0)
                        {
                              

                              if (obj_cls_MessageBox.MessageBoxStatic("I_Q") == "no")
                              {
                                    return;
                              }

                              if (obj_cls_TBL_RIGHTS_TEMPLATE.insertionUpdation('I'))
                              {
                                    Referesh("Partial");
                                    if (isDisturebedOnce)
                                          obj_frm_TBL_RIGHTS_TEMPLATE.Close();
                              }
                        }

                  }
                  else
                  {

                        string executeFunctions = valueGetting(false);

                        if (executeFunctions != "ok")
                        {
                              if (executeFunctions != "N")
                              {
                                    if (executeFunctions == "V_P")
                                    {
                                          obj_cls_MessageBox.MessageBoxStatic("VP_E");
                                          return;
                                    }
                                    else
                                    {
                                          obj_cls_MessageBox.MessageBoxDynamics(executeFunctions, "I_E");
                                          return;

                                    }
                              }
                        }

                        if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'I')
                        {

                              if (obj_cls_MessageBox.MessageBoxStatic("I_Q") == "no")
                              {
                                    return;
                              }

                              if (obj_cls_TBL_RIGHTS_TEMPLATE.insertionUpdation('I'))
                              {
                                    Referesh("Partial");
                                    if (isDisturebedOnce)
                                          obj_frm_TBL_RIGHTS_TEMPLATE.Close();
                              }


                        }

                        else if (obj_frm_TBL_RIGHTS_TEMPLATE.DBStatus == 'U')
                        {

                              if (obj_cls_MessageBox.MessageBoxStatic("U_Q") == "no")
                              {
                                    return;
                              }

                              if (obj_cls_TBL_RIGHTS_TEMPLATE.insertionUpdation('U'))
                              {
                                    Referesh("Partial");
                                    if (isDisturebedOnce)
                                          obj_frm_TBL_RIGHTS_TEMPLATE.Close();
                              }
                        }
                  }
            }

            public void selection(string pStatus, string pId)
            {

                  if (pStatus == "N")
                  {
                        if (pId == "")
                        {
                              obj_cls_DataSet_GEN.f_TBL_RIGHTS_TEMPLATE("L", pId);
                              DataSet ds = obj_cls_DataSet_GEN.g_TBL_RIGHTS_TEMPLATE;
                              if (ds == null)
                              {
                                    obj_cls_MessageBox.MessageBoxStatic("BLL_E");
                                    Referesh("False");
                                    return;

                              }

                              dt_Datanavigator = ds.Tables[0].Copy();
                              dt_ValueBase = ds.Tables[1].Copy();
                              dt_VisibleBase = ds.Tables[2].Copy();
                              initiateTreeForValueBaseRights();
                              initiateTreeForVisibleBaseRights();


                              obj_frm_TBL_RIGHTS_TEMPLATE.DataNavigator_Navigate.DataSource = dt_Datanavigator;
                        }
                        else
                        {

                              string ID = dt_Datanavigator.Rows[Convert.ToInt32(pId)][cls_CTBL_RIGHTS_TEMPLATE.priRIGHTS_TEMPLATE_ID].ToString();
                              selection("V", ID);
                        }
                  }
                  else if (pStatus == "A")
                  {

                        obj_cls_DataSet_GEN.f_TBL_RIGHTS_TEMPLATE("A", pId);
                        DataSet ds = obj_cls_DataSet_GEN.g_TBL_RIGHTS_TEMPLATE;

                        if (ds == null)
                        {
                              obj_cls_MessageBox.MessageBoxStatic("BLL_E");
                              Referesh("False");
                              return;

                        }


                        obj_frlLOOKUP = new GEN.GEN_GEN.Look.frlLOOKUP(ds, 4, true, "150,150,150,150,150,150,150,150,150,150,150", 1);
                        obj_frlLOOKUP.ShowDialog();
                        string value = GEN.GEN_GEN.Look.frlLOOKUP.value;
                        if (value != "")
                        {
                              string[] cols_values = value.Split('|');
                              obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_navigate.Checked = false;
                              selection("V", cols_values[2]);
                        }

                  }
                  else
                  {

                        obj_frm_TBL_RIGHTS_TEMPLATE.maxID = obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_ID.Text = pId;
                        obj_cls_DataSet_GEN.f_TBL_RIGHTS_TEMPLATE("V", pId);
                        DataSet ds = obj_cls_DataSet_GEN.g_TBL_RIGHTS_TEMPLATE;
                        string executeFunctions = "";

                        if (!GEN.GEN_GEN.GenericClasses.DataTables.cls_NativDataSet.checkIsNullIsNoTableIsTableEmpty(ds, 0))
                        {
                              executeFunctions = valueSetting(ds);
                        }
                        else
                        {

                              obj_cls_MessageBox.MessageBoxStatic("TB_E");
                              Referesh("False");
                              return;

                        }


                        if (executeFunctions != "ok")
                        {
                              obj_cls_MessageBox.MessageBoxDynamics(executeFunctions, "S_E");
                              return;

                              Referesh("False");


                        }


                  }

            }




            void initiateTreeForValueBaseRights()
            {
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_valueBase.DataSource = dt_ValueBase;

                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_valueBase.ParentFieldName = cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_parentKey;
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_valueBase.KeyFieldName = cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_primaryKey;
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_valueBase.PopulateColumns();
              
                  
                  //objfrm_COA.TL_COA.OptionsBehavior.AllowExpandOnDblClick = true;

            }

            void initiateTreeForVisibleBaseRights()
            {
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_visibleBase.DataSource = dt_VisibleBase;

                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_visibleBase.ParentFieldName = cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_parentKey;
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_visibleBase.KeyFieldName = cls_CTBL_RIGHTS_TEMPLATE.RIGHTS_TEMPLATE_primaryKey;
                  obj_frm_TBL_RIGHTS_TEMPLATE.TreeList_visibleBase.PopulateColumns();
                  //objfrm_COA.TL_COA.OptionsBehavior.AllowExpandOnDblClick = true;

            }


            int xID = 0;

            public bool loadRightsFromMDI_recursiveParent()
            {
                  string tmpName = "";
                  try
                  {

                        obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Rows.Clear();
                        dt_VisibleBase.Rows.Clear();
                        obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Clear();

                        foreach (BarItemLink subItem in GEN_PRESENTATION_LAYER.cls_StaticObjects.obj_MDIClassic.bar2.ItemLinks)
                        {
                              BarItem barItem = subItem.Item;

                              if (barItem.Visibility == BarItemVisibility.Always)
                              {

                                    Type tmp_Type = barItem.GetType();


                                    tmpName = tmp_Type.Name == "BarButtonItem" ? (barItem.Tag == null ? "" : barItem.Tag.ToString()) : barItem.Name;

                                     if (tmpName == "")
                                     {

                                           //tmpName = xID.ToString();
                                           obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Add(barItem.Caption);
                                           //xID++;
                                     }
                                     else
                                     {
                                           obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Rows.Add(

                                              "N"
                                           , tmpName
                                           , barItem.Caption
                                           , 0// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                                           , tmp_Type.Name == "BarSubItem" ? "Menu" : "Form"
                                           , "True"
                                           , ""
                                           , ""
                                           , true// obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_RIGHTS_TEMPLATE_isAddedDirectly.Checked
                                            , "Visible"
                                           );


                                           dt_VisibleBase.Rows.Add(

                                              "N"
                                           , tmpName
                                           , barItem.Caption
                                           , 0// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                                           , tmp_Type.Name == "BarSubItem" ? "Menu" : "Form"
                                           
                                           );


                                           if (tmp_Type.Name == "BarSubItem")
                                           {
                                                 BarSubItem barSubItem = (BarSubItem)subItem.Item;
                                                 loadRightsFromMDI_recursiveChild(barSubItem, tmpName, 0);

                                           }
                                           else if (tmp_Type.Name == "BarButtonItem")
                                           {
                                                 if (tmpName != "NoForm")
                                                       if (!loadActionsFromSelectedForm(tmpName, 0))
                                                       {

                                                             obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Add(barItem.Caption);

                                                       }


                                           }
                                     }
                              }
                        }

                  }
                  catch (Exception ex)
                  {
                        MessageBox.Show("Parent : " + tmpName  );
                       
                        //obj_cls_MessageBox.MessageBoxStatic("VP_E");
                        return false;
                  }

                  return true;

            }

            bool loadRightsFromMDI_recursiveChild(BarSubItem pChildBarSubItem, string pParent, int pLevel)
            {
                  string tmpName = "";
                  try
                  {

                        foreach (BarItemLink subItem in pChildBarSubItem.ItemLinks)
                        {
                              BarItem barItem = subItem.Item;

                              if (barItem.Visibility == BarItemVisibility.Always)
                              {
                                    Type tmp_Type = barItem.GetType();

                                     tmpName = tmp_Type.Name == "BarButtonItem" ? (barItem.Tag == null ? "" : barItem.Tag.ToString()) : barItem.Name;

                                     if (tmpName == "")
                                     {

                                           //tmpName = xID.ToString();
                                           obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Add(barItem.Caption);
                                           //xID++;
                                     }
                                     else
                                     {

                                           obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Rows.Add(

                                              pParent
                                           , tmpName
                                           , barItem.Caption
                                           , (pLevel++)// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                                           , tmp_Type.Name == "BarSubItem" ? "Menu" : "Form"
                                           , "True"
                                           , ""
                                           , ""
                                           , true// obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_RIGHTS_TEMPLATE_isAddedDirectly.Checked
                                            , "Visible"
                                           );


                                           dt_VisibleBase.Rows.Add(

                                              pParent
                                           , tmpName
                                           , barItem.Caption
                                           , 0// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                                           , tmp_Type.Name == "BarSubItem" ? "Menu" : "Form"

                                           );


                                           if (tmp_Type.Name == "BarSubItem")
                                           {
                                                 BarSubItem barSubItem = (BarSubItem)subItem.Item;
                                                 loadRightsFromMDI_recursiveChild(barSubItem, tmpName, pLevel);

                                           }
                                           else if (tmp_Type.Name == "BarButtonItem")
                                           {
                                                 if (tmpName == "NoForm")
                                                 {

                                                       string str = "";
                                                 }

                                                 if (barItem.Caption == "Profit or Loss" || barItem.Caption == "Ledger")
                                                 {
                                                       string str = "";
                                                 }
                                                 if (tmpName != "NoForm")

                                                       //if (tmpName == "frm_Item_Transaction_Report")
                                                       if (!loadActionsFromSelectedForm(tmpName, 0))
                                                       {
                                                             
                                                             obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Add(barItem.Caption);

                                                       }


                                           }
                                     }
                              }
                        }
                  }
                  catch (Exception ex)
                  {
                        MessageBox.Show("Child : " +tmpName+" , " +pParent);
                        //obj_cls_MessageBox.MessageBoxStatic("VP_E");
                        return false;
                  }

                  return true;



            }

            bool loadActionsFromSelectedForm(string pParent, int pLevel)
            {
                  try
                  {


                        string[] tmpparents = pParent.Split('|');

                        object obj = MagicallyCreateInstance(tmpparents[0]);
                        DevExpress.XtraEditors.XtraForm obj_Form = (DevExpress.XtraEditors.XtraForm)obj;
                        //GEN_PRESENTATION_LAYER.Forms.TBL_KEYS_TYPES.frm_TBL_KEYS_TYPES obj = new TBL_KEYS_TYPES.frm_TBL_KEYS_TYPES();
                        if (obj_Form.Tag.ToString() != "NoForm") 
                        {
                              Control CTrl = obj_Form.Controls["ListBoxControl_Rights"];
                              ListBoxControl tmpListBoxControl = (ListBoxControl)CTrl;

                             
                              //if (obj_Form.Tag.ToString() == "NoForm1")
                              //{

                              //      string str = "";

                              //}

                              if (CTrl != null)
                              {


                                    for (int x = 0; x < tmpListBoxControl.Items.Count; x++)
                                    {
                                          obj_cls_TBL_RIGHTS_TEMPLATE.dt_Detail.Rows.Add(

                                          pParent
                                       , pParent + tmpListBoxControl.Items[x].ToString()
                                       , tmpListBoxControl.Items[x].ToString()
                                       , (pLevel++)// Convert.ToInt32(obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim() == "" ? "0" : obj_frm_TBL_RIGHTS_TEMPLATE.TextEdit_RIGHTS_TEMPLATE_level.EditValue.ToString().Trim())
                                       , "Action"
                                       , "True"
                                       , ""
                                       , ""
                                       , true// obj_frm_TBL_RIGHTS_TEMPLATE.CheckEdit_RIGHTS_TEMPLATE_isAddedDirectly.Checked
                                        , "Visible"
                                       );



                                    }
                              }
                              else
                                    return false;
                        }

                  }
                  catch (Exception ex)
                  {
                        //MessageBox.Show("Actions : " + pParent);
                        //obj_frm_TBL_RIGHTS_TEMPLATE.ListBoxControl_notInserted.Items.Add(pParent);
                        //obj_cls_MessageBox.MessageBoxStatic("VP_E");
                        return false;
                  }

                  return true;

            }


            private static object MagicallyCreateInstance(string className)
            {
                  var assembly = Assembly.GetExecutingAssembly();

                  var type = assembly.GetTypes()
                      .First(t => t.Name == className);

                  return Activator.CreateInstance(type);
            }


            //VVVGRIDINFOVVV



      }
}
